<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Tasmania Web GIS</title>

<!-- OpenLayers -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol@v10.6.1/ol.css" />
<script src="https://cdn.jsdelivr.net/npm/ol@v10.6.1/dist/ol.js"></script>

<!-- Layer Switcher -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol-layerswitcher@4.1.2/dist/ol-layerswitcher.css" />
<script src="https://cdn.jsdelivr.net/npm/ol-layerswitcher@4.1.2/dist/ol-layerswitcher.js"></script>

<style>
  html, body { height: 100%; margin: 0; font-family: Arial, sans-serif; }
  #header {
    padding: 10px;
    background: #f5f5f5;
    border-bottom: 1px solid #ccc;
  }
  #map { width: 100%; height: calc(100vh - 60px); } /* leave space for header */
</style>
</head>
<body>

<div id="header">
  <h3>Lab 3: Question 4</h3>
  <h4>Author: Nicholas Johnson</h4>
</div>

<div id="map"></div>

<script>
const AZURE_KEY = "8JpohGxKC5AHhR0iqQigE4HrL3dwRfpCXQjlAH8fStlQG3a7ofuBJQQJ99BJACYeBjFNMnj2AAAgAZMPeLst";
const wmsUrl = "https://data.stategrowth.tas.gov.au/geoserver/ows";

// Tasmania center
const tasCenter = ol.proj.fromLonLat([146.8, -42.0]);

// Base layer: Azure Road
const azureRoad = new ol.layer.Tile({
  title: "Azure Hybrid Maps",
  type: "base",
  visible: true,
  source: new ol.source.XYZ({
    url: `https://atlas.microsoft.com/map/tile?api-version=2022-08-01&tilesetId=microsoft.imagery.hybrid&zoom={z}&x={x}&y={y}&subscription-key=${AZURE_KEY}`,
    crossOrigin: "anonymous",
    maxZoom: 19
  })
});

// WMS layers
const carriageways = new ol.layer.Tile({
  title: "Carriageways (WMS)",
  source: new ol.source.TileWMS({
    url: wmsUrl,
    params: {
      LAYERS: "ssg:GEO_CARRIAGEWAY",
      FORMAT: "image/png",
      TRANSPARENT: true,
      VERSION: "1.3.0",
      CRS: "CRS:84"
    },
    serverType: "geoserver",
    crossOrigin: "anonymous"
  }),
  visible: true
});

const cadastre = new ol.layer.Tile({
  title: "Cadastre Parcels (WMS)",
  source: new ol.source.TileWMS({
    url: wmsUrl,
    params: {
      LAYERS: "pam:GEO_CADASTRE",
      FORMAT: "image/png",
      TRANSPARENT: true,
      VERSION: "1.3.0",
      CRS: "CRS:84"
    },
    serverType: "geoserver",
    crossOrigin: "anonymous"
  }),
  visible: false
});

const busTrips = new ol.layer.Tile({
  title: "Bus Trips (WMS)",
  source: new ol.source.TileWMS({
    url: wmsUrl,
    params: {
      LAYERS: "ssg:GEO_BRM_TRIP",
      FORMAT: "image/png",
      TRANSPARENT: true,
      VERSION: "1.3.0",
      CRS: "CRS:84"
    },
    serverType: "geoserver",
    crossOrigin: "anonymous"
  }),
  visible: false
});

// Map
const map = new ol.Map({
  target: "map",
  layers: [
    new ol.layer.Group({ title: "Base Maps", layers: [azureRoad] }),
    new ol.layer.Group({ title: "Tasmania Overlays", layers: [carriageways, cadastre, busTrips] })
  ],
  view: new ol.View({
    center: tasCenter,
    zoom: 7
  }),
  controls: [
    new ol.control.Zoom(),
    new LayerSwitcher({ tipLabel: "Layers", groupSelectStyle: "children" })
  ]
});
</script>

</body>
</html>

